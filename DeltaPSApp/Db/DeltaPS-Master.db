#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBDEND


# Short and long form of identification string
record(stringin, "$(device):Info:IDN") {
  field(DESC, "SCPI identification string")
  field(DTYP, "Soft Channel")
  field(SCAN, "10 second")
  field(INP, "$(slaveA):Status:IDN.VAL NPP MS")
  field(PINI, "YES")
  field(TPRO, "0")
}

record(calc, "$(device):Voltage:Readback") {
  field(DESC, "Get Output Voltage Readback")
  field(SCAN, "$(scan) second")
  field(CALC, "MAX(A,B)")
  field(INPA, "$(slaveA):Voltage:Readback.VAL NPP MS")
  field(INPB, "$(slaveB):Voltage:Readback.VAL NPP MS")
  field(PREC, "$(prec)")
  field(EGU, "V")
  field(HOPR, "$(v_max)")
  field(LOPR, "$(v_min)")
  field(TPRO, "0")
}

record(calc, "$(device):Voltage:Setpoint:Get") {
  field(DESC, "Get Setpoint for Output Voltage")
  field(SCAN, "$(scan) second")
  field(CALC, "MAX(A,B)")
  field(INPA, "$(slaveA):Voltage:Setpoint:Get.VAL NPP MS")
  field(INPB, "$(slaveB):Voltage:Setpoint:Get.VAL NPP MS")
  field(PINI, "YES")
  field(PREC, "$(prec)")
  field(EGU,  "V")
  field(HOPR, "$(v_max)")
  field(LOPR, "$(v_min)")
  field(TPRO, "0")
}

record(ao, "$(device):Voltage:Setpoint") {
  field(DESC, "Setpoint for Output Voltage")
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(FLNK, "$(device):Voltage:int_Calc PP MS")
  field(PREC, "$(prec)")
  field(EGU, "V")
  field(HOPR, "$(v_max)")
  field(LOPR, "$(v_min)")
  field(DRVH, "$(v_max)")
  field(DRVL, "$(v_min)")
  field(STAT, "NO_ALARM")
  field(SEVR, "NO_ALARM")
  field(TPRO, "0")
}

record(calc, "$(device):Voltage:int_Calc") {
  field(SCAN, "Passive")
  field(CALC, "A")
  field(INPA, "$(device):Voltage:Setpoint.VAL NPP MS")
  field(FLNK, "$(device):Voltage:int_Set PP MS")
  field(TPRO, "0")
}

record(dfanout, "$(device):Voltage:int_Set") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Voltage:int_Calc.VAL NPP MS")
  field(OUTA, "$(slaveA):Voltage:Setpoint PP")
  field(OUTB, "$(slaveB):Voltage:Setpoint PP")
  field(FLNK, "$(device):int_fanout")
  field(TPRO, "0")
}

record(dfanout, "$(device):Voltage:int_SetInit") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Voltage:Setpoint:Get.VAL PP MS")
  field(OUTA, "$(slaveA):Voltage:Setpoint NPP")
  field(PINI, "YES")
  field(TPRO, "0")
}

record(calc, "$(device):Current:Readback") {
  field(DESC, "Get Output Current")
  field(SCAN, "$(scan) second")
  field(CALC, "A+B")
  field(INPA, "$(slaveA):Current:Readback.VAL NPP MS")
  field(INPB, "$(slaveB):Current:Readback.VAL NPP MS")
  field(PREC, "$(prec)")
  field(EGU,  "A")
  field(HOPR, "$(c_max)")
  field(LOPR, "$(c_min)")
  field(TPRO, "0")
}

record(calc, "$(device):Current:Setpoint:Get") {
  field(DESC, "Get Setpoint for Output Current")
  field(SCAN, "$(scan) second")
  field(CALC, "A+B")
  field(INPA, "$(slaveA):Current:Setpoint:Get.VAL NPP MS")
  field(INPB, "$(slaveB):Current:Setpoint:Get.VAL NPP MS")
  field(PREC, "$(prec)")
  field(EGU,  "A")
  field(HOPR, "$(c_max)")
  field(LOPR, "$(c_min)")
  field(TPRO, "0")
  field(PINI, "1")
}

record(ao, "$(device):Current:Setpoint") {
  field(DESC, "Setpoint for Output Current")
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(FLNK, "$(device):Current:int_Calc NMS")
  field(PREC, "$(prec)")
  field(EGU, "A")
  field(VAL, "0")
  field(HOPR, "$(c_max)")
  field(LOPR, "$(c_min)")
  field(DRVH, "$(c_max)")
  field(DRVL, "$(c_min)")
  field(STAT, "NO_ALARM")
  field(SEVR, "NO_ALARM")
  field(TPRO, "0")
}

record(calc, "$(device):Current:int_Calc") {
  field(SCAN, "Passive")
  field(CALC, "A/2")
  field(INPA, "$(device):Current:Setpoint.VAL NPP NMS")
  field(FLNK, "$(device):Current:int_Set NMS")
  field(TPRO, "0")
}

record(dfanout, "$(device):Current:int_Set") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Current:int_Calc.VAL NMS")
  field(OUTA, "$(slaveA):Current:Setpoint PP")
  field(OUTB, "$(slaveB):Current:Setpoint PP")
  field(FLNK, "$(device):int_fanout")
  field(TPRO, "0")
}

record(dfanout, "$(device):Current:Sync") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Current:Setpoint:Get.VAL NPP NMS")
  field(OUTA, "$(device):Current:Setpoint PP")
  field(TPRO, "0")
}

record(fanout, "$(device):int_fanout") {
  field(LNK1, "$(device):Voltage:Setpoint:Get")
  field(LNK2, "$(device):Voltage:Readback")
  field(LNK3, "$(device):Current:Setpoint:Get")
  field(LNK4, "$(device):Current:Readback")
}

record(mbbiDirect, "$(device):Status") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(SCAN, "$(scan) second")
  field(INP, "$(device):Status:int_Sum.VAL PP MSS")
  field(PINI, "YES")
  field(TPRO, "0")
}

record(calc, "$(device):Status:int_Sum") {
  field(SCAN, "Passive")
  field(CALC, "(A | B) + (C << 15)")
  field(INPA, "$(slaveA):Status.VAL NPP MSS")
  field(INPB, "$(slaveB):Status.VAL NPP MSS")
  field(INPC, "$(device):Status:DelegateDiff.VAL NPP MSS")
  field(FLNK, "$(device):Status:Bit0 PP MSS")
  field(TPRO, "0")
}

record(bi, "$(device):Status:ErrorSum") {
  field(DESC, "Device has errors")
  field(DTYP, "Soft Channel")
  field(SCAN, "$(scan) second")
  field(INP, "$(device):int_ErrorSum.VAL PP MSS")
  field(TPRO, "0")
}

record(calc, "$(device):int_ErrorSum") {
  field(SCAN, "Passive")
  field(CALC, "(A | B | C) > 0 ? 1 : 0")
  field(INPA, "$(slaveA):Status:ErrorSum.VAL NPP MSS")
  field(INPB, "$(slaveB):Status:ErrorSum.VAL NPP MSS")
  field(INPC, "$(device):Status:DelegateDiff.VAL NPP MSS")
  field(TPRO, "0")
}

record(fanout, "$(device):int_fanoutS") {
  field(LNK1, "$(device):Status")
  field(LNK2, "$(device):Status:ErrorSum")
  field(LNK3, "$(device):Status:On")
}

record(longin, "$(device):Status:On") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(SCAN, "$(scan) second")
  field(INP, "$(device):Status:int_ON.VAL PP MSS")
  field(TPRO, "0")
}

record(calc, "$(device):Status:int_ON") {
  field(SCAN, "Passive")
  field(CALC, "A & B")
  field(INPA, "$(slaveA):Status:On.VAL NPP MSS")
  field(INPB, "$(slaveB):Status:On.VAL NPP MSS")
  field(TPRO, "0")
}

record(calc, "$(device):Status:DelegateDiff") {
  field(DESC, "Delegates return different Setpoints")
  field(SCAN, "$(scan) second")
  field(CALC, "(ABS(A-B)>0.0001 ? 1 : 0) | (C != D)")
  field(INPA, "$(slaveA):Current:Setpoint:Get.VAL NPP MSS")
  field(INPB, "$(slaveB):Current:Setpoint:Get.VAL NPP MSS")
  field(INPC, "$(slaveA):Status:On.VAL NPP MSS")
  field(INPD, "$(slaveB):Status:On.VAL NPP MSS")
  field(FLNK, "$(device):int_fanoutDelegateDiff PP")
  field(TPRO, "0")
  field(PINI, "1")
}

record(fanout, "$(device):int_fanoutDelegateDiff") {
  field(LNK1, "$(device):DelegateDiffSafety")
  field(LNK2, "$(device):Status:ErrorSum")
}

record(calcout, "$(device):DelegateDiffSafety") {
  field(DESC, "Delegates return different Setpoints")
  field(SCAN, "Passive")
  field(CALC, "(ABS(A-B)>0.1 ? 1 : 0) | (C != D)")
  field(INPA, "$(slaveA):Current:Setpoint:Get.VAL NPP MSS")
  field(INPB, "$(slaveB):Current:Setpoint:Get.VAL NPP MSS")
  field(INPC, "$(slaveA):Status:On.VAL NPP MSS")
  field(INPD, "$(slaveB):Status:On.VAL NPP MSS")
  field(OOPT, "Transition To Non-zero")
  field(DOPT, "Use CALC")
  field(OUT, "$(device):Current:int_Set0.PROC PP")
  field(TPRO, "0")
}

record(dfanout, "$(device):Current:int_Set0") {
  field(SELM, "All")
  field(OMSL, "supervisory")
  field(VAL,  "0")
  field(OUTA, "$(slaveA):Current:Setpoint PP")
  field(OUTB, "$(slaveB):Current:Setpoint PP")
  field(FLNK, "$(device):int_fanout")
  field(TPRO, "0")
}


record(bo, "$(device):Cmd:Reset") {
  field(DESC, "Reset the PS unit")
  field(DTYP, "Soft Channel")
  field(FLNK, "$(device):int_Reset PP NMS")
  field(STAT, "NO_ALARM")
  field(SEVR, "NO_ALARM")
  field(TPRO, "0")
}

record(dfanout, "$(device):int_Reset") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Cmd:Reset.VAL NPP NMS")
  field(OUTA, "$(slaveA):Cmd:Reset PP")
  field(OUTB, "$(slaveB):Cmd:Reset PP")
  field(FLNK, "$(device):int_fanoutS PP")
  field(TPRO, "0")
}

record(bo, "$(device):Cmd:On") {
  field(DESC, "Switches output on the PS unit")
  field(DTYP, "Soft Channel")
  field(FLNK, "$(device):int_On PP")
  field(STAT, "NO_ALARM")
  field(SEVR, "NO_ALARM")
  field(TPRO, "0")
}

record(dfanout, "$(device):int_On") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Cmd:On.VAL NPP")
  field(OUTA, "$(slaveA):Cmd:On PP")
  field(OUTB, "$(slaveB):Cmd:On PP")
  field(FLNK, "$(device):int_fanoutS PP")
  field(TPRO, "0")
}

record(bo, "$(device):Cmd:Off") {
  field(DESC, "Switches output on the PS unit")
  field(DTYP, "Soft Channel")
  field(FLNK, "$(device):int_Off PP")
  field(STAT, "NO_ALARM")
  field(SEVR, "NO_ALARM")
  field(TPRO, "0")
}

record(dfanout, "$(device):int_Off") {
  field(SELM, "All")
  field(OMSL, "closed_loop")
  field(DOL,  "$(device):Cmd:Off.VAL NPP NMS")
  field(OUTA, "$(slaveA):Cmd:Off PP")
  field(OUTB, "$(slaveB):Cmd:Off PP")
  field(FLNK, "$(device):int_fanoutS PP")
  field(TPRO, "0")
}

record(stringin, "$(device):Info:Alias") {
  field(DESC, "Alternative device name")
  field(SCAN, "Passive")
  field(DTYP, "Soft Channel")
  field(VAL, "$(alias)")
}

record(stringin, "$(device):Info:DelegateA") {
  field(DESC, "Delegate device A")
  field(SCAN, "Passive")
  field(DTYP, "Soft Channel")
  field(VAL, "$(slaveA)")
}

record(stringin, "$(device):Info:DelegateB") {
  field(DESC, "Delegate device B")
  field(SCAN, "Passive")
  field(DTYP, "Soft Channel")
  field(VAL, "$(slaveB)")
}

record(bi, "$(device):Info:HasDelegates") {
  field(DESC, "Device is master device for slaves")
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(VAL, "1")
}


record(mbbi, "$(device):Status:Strings") {
  field(DESC, "Descriptions of status bits")
  field(SCAN, "Passive")
  field(DTYP, "Soft Channel")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(THVL, "3")
  field(FRVL, "4")
  field(FVVL, "5")
  field(SXVL, "6")
  field(SVVL, "7")
  field(EIVL, "8")
  field(NIVL, "9")
  field(TEVL, "10")
  field(ELVL, "11")
  field(TVVL, "12")
  field(TTVL, "13")
  field(FTVL, "14")
  field(FFVL, "15")
  field(ZRST, "Ctrl Volt")
  field(ONST, "Ctrl Curr")
  field(TWST, "Remote Volt")
  field(THST, "Volt lim")
  field(FRST, "Curr lim")
  field(FVST, "Remote Curr")
  field(SXST, "DC Out Fail")
  field(SVST, "Delegate Fail")
  field(EIST, "Over Temp")
  field(NIST, "PowSink OverLo")
  field(TEST, "AC In Fail")
  field(ELST, "Interlock")
  field(TVST, "Rem ShDdown")
  field(TTST, "Output ON")
  field(FTST, "Front panel lock")
  field(FFST, "Delegate Diff")
}


record(bi, "$(device):Status:Bit0") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B0 NPP MSS")
  field(FLNK, "$(device):Status:Bit1 PP NMS")
  field(DESC, "Constant Volt")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit1") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B1 NPP MSS")
  field(FLNK, "$(device):Status:Bit2 PP NMS")
  field(DESC, "Constant Current")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit2") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B2 NPP MSS")
  field(FLNK, "$(device):Status:Bit3 PP NMS")
  field(DESC, "Rem CV")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit3") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B3 NPP MSS")
  field(FLNK, "$(device):Status:Bit4 PP NMS")
  field(DESC, "Volt Limit")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit4") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B4 NPP MSS")
  field(FLNK, "$(device):Status:Bit5 PP NMS")
  field(DESC, "Curr Limit")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit5") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B5 NPP MSS")
  field(FLNK, "$(device):Status:Bit6 PP NMS")
  field(DESC, "Rem CC")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit6") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B6 NPP MSS")
  field(FLNK, "$(device):Status:Bit7 PP NMS")
  field(DESC, "DC Out Fail")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit7") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B7 NPP MSS")
  field(FLNK, "$(device):Status:Bit8 PP NMS")
  field(DESC, "N/A")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit8") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B8 NPP MSS")
  field(FLNK, "$(device):Status:Bit9 PP NMS")
  field(DESC, "Over Temp")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit9") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.B9 NPP MSS")
  field(FLNK, "$(device):Status:Bit10 PP NMS")
  field(DESC, "PwrSink OvrLoad")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit10") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BA NPP MSS")
  field(FLNK, "$(device):Status:Bit11 PP NMS")
  field(DESC, "AC In Fail")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit11") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BB NPP MSS")
  field(FLNK, "$(device):Status:Bit12 PP NMS")
  field(DESC, "Interlock")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit12") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BC NPP MSS")
  field(FLNK, "$(device):Status:Bit13 PP NMS")
  field(DESC, "Rem Shutdown")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit13") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BD NPP MSS")
  field(FLNK, "$(device):Status:Bit14 PP NMS")
  field(DESC, "Output ON")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit14") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BE NPP MSS")
  field(FLNK, "$(device):Status:Bit15 PP NMS")
  field(DESC, "Front panel lock")
  field(ZSV, "NO_ALARM")
  field(OSV, "NO_ALARM")
  field(TPRO, "0")
}

record(bi, "$(device):Status:Bit15") {
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(INP, "$(device):Status.BF NPP MSS")
  field(DESC, "Delegate Diff")
  field(ZSV, "NO_ALARM")
  field(OSV, "MAJOR")
  field(TPRO, "0")
}


#! Further lines contain data used by VisualDCT
#! View(2042,0,1.0)
#! Record("$(device):Status:IDN",24,14,0,0,"$(device):Status:IDN")
#! Record("$(device):SwitchRemote",272,22,0,0,"$(device):SwitchRemote")
#! Record("$(device):Cmd:Reset",520,22,0,0,"$(device):Cmd:Reset")
#! Record("$(device):Voltage:Readback",768,19,0,1,"$(device):Voltage:Readback")
#! Record("$(device):Voltage:Setpoint:Get",1016,19,0,1,"$(device):Voltage:Setpoint:Get")
#! Record("$(device):Voltage:Setpoint",1260,19,0,0,"$(device):Voltage:Setpoint")
#! Field("$(device):Voltage:Setpoint.FLNK",16777215,1,"$(device):Voltage:Setpoint.FLNK")
#! Link("$(device):Voltage:Setpoint.FLNK","$(device):int_fanout")
#! Record("$(device):Current:Readback",1512,19,0,0,"$(device):Current:Readback")
#! Record("$(device):Current:Setpoint:Get",1760,19,0,1,"$(device):Current:Setpoint:Get")
#! Record("$(device):Current:Setpoint",2008,39,0,0,"$(device):Current:Setpoint")
#! Field("$(device):Current:Setpoint.FLNK",16777215,0,"$(device):Current:Setpoint.FLNK")
#! Link("$(device):Current:Setpoint.FLNK","$(device):int_fanout")
#! Record("$(device):Status",2256,20,0,0,"$(device):Status")
#! Field("$(device):Status.FLNK",16777215,1,"$(device):Status.FLNK")
#! Link("$(device):Status.FLNK","$(device):int_ErrorSum")
#! Field("$(device):Status.VAL",16777215,0,"$(device):Status.VAL")
#! Record("$(device):int_fanout",1720,288,0,0,"$(device):int_fanout")
#! Field("$(device):int_fanout.LNK1",16777215,0,"$(device):int_fanout.LNK1")
#! Link("$(device):int_fanout.LNK1","$(device):Voltage:Setpoint:Get")
#! Field("$(device):int_fanout.LNK2",16777215,0,"$(device):int_fanout.LNK2")
#! Link("$(device):int_fanout.LNK2","$(device):Voltage:Readback")
#! Field("$(device):int_fanout.LNK3",16777215,1,"$(device):int_fanout.LNK3")
#! Link("$(device):int_fanout.LNK3","$(device):Current:Setpoint:Get")
#! Field("$(device):int_fanout.LNK4",16777215,0,"$(device):int_fanout.LNK4")
#! Link("$(device):int_fanout.LNK4","$(device):Current:Readback")
#! Record("$(device):int_ErrorSum",2520,68,0,0,"$(device):int_ErrorSum")
#! Field("$(device):int_ErrorSum.INPA",16777215,0,"$(device):int_ErrorSum.INPA")
#! Link("$(device):int_ErrorSum.INPA","$(device):Status.VAL")
#! Field("$(device):int_ErrorSum.FLNK",16777215,1,"$(device):int_ErrorSum.FLNK")
#! Link("$(device):int_ErrorSum.FLNK","$(device):ErrorSum")
#! Field("$(device):int_ErrorSum.VAL",16777215,0,"$(device):int_ErrorSum.VAL")
#! Record("$(device):ErrorSum",2780,108,0,0,"$(device):ErrorSum")
#! Field("$(device):ErrorSum.INP",16777215,0,"$(device):ErrorSum.INP")
#! Link("$(device):ErrorSum.INP","$(device):int_ErrorSum.VAL")
